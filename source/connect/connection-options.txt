.. _php-connection-options:

==========================
Specify Connection Options
==========================

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

.. facet::
   :name: genre
   :values: reference

.. meta::
   :keywords: connection string, URI, server, Atlas, settings, configure

Overview
--------

This page describes the MongoDB connection and authentication options
available in the {+driver-short+}.

Set Connection Options
----------------------

You can configure your connection by specifying options in the connection URI or by
passing them to the ``MongoDB\Client`` constructor.

.. TODO: 
-code samples
- fix table widths

.. _php-connection-uri:

Using the Connection URI
~~~~~~~~~~~~~~~~~~~~~~~~

If you pass a connection URI to the ``MongoDB\Client`` constructor, you can include
connection options in the URI as ``<name>=<value>`` pairs. In the following example,
the connection URI contains the ``tls`` option with a value of ``true`` and the
``tlsCertificateKeyFile`` option with a value of ``/path/to/file.pem``:

.. literalinclude:: /includes/connect/connection-options.php
   :language: php
   :copyable: true
   :start-after: // start-connection-uri
   :end-before: // end-connection-uri
   :emphasize-lines: 8

.. _php-client-object:

Using a MongoDB\\Client Object
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

You can pass connection options to the ``MongoDB\Client`` constructor
instead of including them in your connection URI.
Configuring the connection this way makes it easier to
change settings at runtime and helps you catch errors during compilation.

The following example shows how to use the the ``$uriOptions`` parameter of the
``MongoDB\Client`` constructor to set connection options:

.. literalinclude:: /includes/connect/connection-options.php
   :language: php
   :copyable: true
   :start-after: // start-client-options 
   :end-before: // end-client-options
   :emphasize-lines: 7-10, 13

.. note::
   
   If you specify an option in both the ``MongoDB\Client`` object and in the connection
   URI, the value in the ``MongoDB\Client`` object takes precedence.

Connection URI Options
----------------------

The following sections describe the options that you can set for your connection to
MongoDB. Each connection option links to its corresponding
entry in the {+mdb-server+} manual. 

Replica Set Options
~~~~~~~~~~~~~~~~~~~

.. list-table::
   :header-rows: 1
   :stub-columns: 1

   * - Connection Option
     - Data Type
     - Syntax

   * - :manual:`directConnection </reference/connection-string/#mongodb-urioption-urioption.directConnection>`
     - {+bool-data-type+}
     - | **MongoDB\Client**: ``$uriOptions = [ 'directConnection' => true ];``
       | **Connection URI**: ``directConnection=true``
   
   * - :manual:`replicaSet </reference/connection-string/#mongodb-urioption-urioption.replicaSet>`
     - {+string-data-type+}
     - | **MongoDB\Client**: ``$uriOptions = [ 'replicaSet' => 'replicaSetName' ];``
       | **Connection URI**: ``replicaSet=replicaSetName``
   
Connection Options
~~~~~~~~~~~~~~~~~~

TLS Options
```````````
To learn about the TLS options available in the {+driver-short+}, see the
:ref:`TLS <php-tls>` page.

Timeout Options
```````````````

.. list-table::
   :header-rows: 1
   :stub-columns: 1

   * - Connection Option
     - Data Type
     - Syntax

   * - :manual:`connectTimeoutMS </reference/connection-string/#mongodb-urioption-urioption.connecttimeoutms>`
     - {+int-data-type+}
     - | **MongoDB\Client**: ``$uriOptions = [ 'connectTimeoutMS' => 20000 ];``
       | **Connection URI**: ``connectTimeoutMS=20000``

   * - :manual:`socketTimeoutMS </reference/connection-string/#mongodb-urioption-urioption.sockettimeoutms>`
     - {+int-data-type+}
     - | **MongoDB\Client**: ``$uriOptions = [ 'socketTimeoutMS' => 400000 ];``
       | **Connection URI**: ``socketTimeoutMS=400000``

.. _php-compression-options:

Compression Options
```````````````````

.. list-table::
   :header-rows: 1
   :stub-columns: 1

   * - Connection Option
     - Data Type
     - Syntax

   * - :manual:`compressors </reference/connection-string/#mongodb-urioption-urioption.compressors>`
     - {+string-data-type+}
     - | **MongoDB\Client**: ``$uriOptions = [ 'compressors' => 'snappy,zstd,zlib' ];``
       | **Connection URI**: ``compressors=snappy,zstd,zlib``

   * - :manual:`zlibCompressionLevel </reference/connection-string/#mongodb-urioption-urioption.zlibcompressionlevel>`
     - {+int-data-type+}
     - | **MongoDB\Client**: ``$uriOptions = [ 'zlibCompressionLevel' => 3 ];``
       | **Connection URI**: ``zlibCompressionLevel=3``

Connection Pool Options
~~~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :header-rows: 1
   :stub-columns: 1

   * - Connection Option
     - Data Type
     - Syntax

   * - :manual:`maxPoolSize </reference/connection-string/#mongodb-urioption-urioption.maxpoolsize>`
     - {+int-data-type+}
     - | **MongoDB\Client**: N/A
       | **Connection URI**: ``maxPoolSize=75``

   * - :manual:`waitQueueTimeoutMS </reference/connection-string/#mongodb-urioption-urioption.waitqueuetimeoutms>`
     - {+int-data-type+}
     - | **MongoDB\Client**: N/A
       | **Connection URI**: ``waitQueueTimeoutMS=10000``

Write Concern Options
~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :header-rows: 1
   :stub-columns: 1

   * - Connection Option
     - Data Type
     - Syntax
   
   * - :manual:`w </reference/connection-string/#mongodb-urioption-urioption.w>` 
     - {+string-data-type+}
     - | **MongoDB\Client**: ``$uriOptions = [ 'w' => 'majority' ];``
       | **Connection URI**: ``w=majority``

   * - :manual:`wTimeoutMS </reference/connection-string/#mongodb-urioption-urioption.wtimeoutms>`
     - {+int-data-type+}
     - | **MongoDB\Client**: ``$uriOptions = [ 'wTimeoutMS' => 10000 ];``
       | **Connection URI**: ``wTimeoutMS=10000``

   * - :manual:`journal </reference/connection-string/#mongodb-urioption-urioption.journal>` 
     - {+bool-data-type+}
     - | **MongoDB\Client**: ``$uriOptions = [ 'journal' => true ];``
       | **Connection URI**: ``journal=true``

Read Concern Options
~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :header-rows: 1
   :stub-columns: 1

   * - Connection Option
     - Data Type
     - Syntax
   
   * - :manual:`readConcernLevel </reference/connection-string/#mongodb-urioption-urioption.readconcernlevel>`
     - {+string-data-type+}
     - | **MongoDB\Client**: ``$uriOptions = [ 'readConcernLevel' => 'majority' ];``
       | **Connection URI**: ``readConcernLevel=majority``

Read Preference Options
~~~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :header-rows: 1
   :stub-columns: 1
   :widths: 25 25 50

   * - Connection Option
     - Data Type
     - Syntax
   
   * - :manual:`readPreference </reference/connection-string/#mongodb-urioption-urioption.readpreference>`
     - `MongoDB\\Driver\\ReadPreference <https://www.php.net/manual/en/class.mongodb-driver-readpreference.php>`__
     -  **MongoDB\Client**:
        
        .. code-block:: 

           $uriOptions = [ 'readPreference' =>
           MongoDB\Driver\ReadPreference.RP_SECONDARY_PREFERRED ];
         **Connection URI**: ``readPreference=secondaryPreferred``
   
   * - :manual:`maxStalenessSeconds </reference/connection-string/#mongodb-urioption-urioption.maxstalenessseconds>`
     - {+int-data-type+}
     - | **MongoDB\Client**: ``$uriOptions = [ 'maxStalenessSeconds' => 30 ];``
       | **Connection URI**: ``maxStalenessSeconds=30``

   * - :manual:`readPreferenceTags </reference/connection-string/#mongodb-urioption-urioption.readpreferencetags>`
     - ``array``
     - | **MongoDB\Client**: ``$uriOptions = [ 'readPreferenceTags' => [[ 'region' => 'east' ], [ 'region' => 'west']];``
       | **Connection URI**: ``readPreferenceTags=region:east,region:west``

Authentication Options
~~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :header-rows: 1
   :stub-columns: 1
   :widths: 30 10 60

   * - Connection Option
     - Data Type
     - Syntax
   
   * - :manual:`authMechanism </reference/connection-string/#mongodb-urioption-urioption.authmechanism>`
     - {+string-data-type+}
     - | **MongoDB\Client**: ``$uriOptions = [ 'authMechanism' => 'MONGODB-X509' ];``
       | **Connection URI**: ``authMechanism=MONGODB-X509``

   * - :manual:`authMechanismProperties </reference/connection-string/#mongodb-urioption-urioption.authmechanismproperties>`
     - {+string-data-type+}
     - | **MongoDB\Client**: ``$uriOptions = [ 'authMechanism' => 'MONGODB-AWS', 'authMechanismProperties' => 'AWS_SESSION_TOKEN:12345' ];``
       | **Connection URI**: ``authMechanism=MONGODB-AWS&authMechanismProperties=AWS_SESSION_TOKEN:12345``

   * - :manual:`authSource </reference/connection-string/#mongodb-urioption-urioption.authsource>`
     - {+string-data-type+}
     - | **MongoDB\Client**: ``$uriOptions = [ 'authSource' => 'admin' ];``
       | **Connection URI**: ``authSource=admin``

Server Selection and Discovery Options
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :header-rows: 1
   :stub-columns: 1
   :widths: 35 10 55

   * - Connection Option
     - Data Type
     - Syntax
   
   * - :manual:`localThresholdMS </reference/connection-string/#mongodb-urioption-urioption.localthresholdms>`
     - {+int-data-type+}
     - | **MongoDB\Client**: ``$uriOptions = [ 'localThresholdMS' => 20 ];``
       | **Connection URI**: ``localThresholdMS=20``

   * - :manual:`serverSelectionTimeoutMS </reference/connection-string/#mongodb-urioption-urioption.serverselectiontimeoutms>`
     - {+int-data-type+}
     - | **MongoDB\Client**: ``$uriOptions = [ 'serverSelectionTimeoutMS' => 40000 ];``
       | **Connection URI**: ``serverSelectionTimeoutMS=40000``

   * - :manual:`serverSelectionTryOnce </reference/connection-string/#mongodb-urioption-urioption.serverselectiontryonce>`
     - {+bool-data-type+}
     - | **MongoDB\Client**: ``$uriOptions = [ 'serverSelectionTryOnce' => false ];``
       | **Connection URI**: ``serverSelectionTryOnce=false``

   * - :manual:`heartbeatFrequencyMS </reference/connection-string/#mongodb-urioption-urioption.heartbeatfrequencyms>`
     - {+int-data-type+}
     - | **MongoDB\Client**: ``$uriOptions = [ 'heartbeatFrequencyMS' => 50000 ];``
       | **Connection URI**: ``heartbeatFrequencyMS=50000``

   * - :manual:`socketCheckIntervalMS </reference/connection-string/#mongodb-urioption-urioption.socketcheckintervalms>`
     - {+int-data-type+}
     - | **MongoDB\Client**: ``$uriOptions = [ 'socketCheckIntervalMS' => 4000 ];``
       | **Connection URI**: ``socketCheckIntervalMS=4000``

Miscellaneous Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. list-table::
   :header-rows: 1
   :stub-columns: 1

   * - Connection Option
     - Data Type
     - Syntax
   
   * - :manual:`appName </reference/connection-string/#mongodb-urioption-urioption.appname>`
     - {+string-data-type+}
     - | **MongoDB\Client**: ``$uriOptions = [ 'appName' => 'myApp' ];``
       | **Connection URI**: ``appName=myApp``

   * - :manual:`retryReads </reference/connection-string/#mongodb-urioption-urioption.retryreads>`
     - {+bool-data-type+}
     - | **MongoDB\Client**: ``$uriOptions = [ 'retryReads' => false ];``
       | **Connection URI**: ``retryReads=false``

   * - :manual:`retryWrites </reference/connection-string/#mongodb-urioption-urioption.retrywrites>`
     - {+bool-data-type+}
     - | **MongoDB\Client**: ``$uriOptions = [ 'retryWrites' => false ];``
       | **Connection URI**: ``retryWrites=false``
   
   * - :manual:`loadBalanced </reference/connection-string/#mongodb-urioption-urioption.loadbalanced>`
     - {+bool-data-type+}
     - | **MongoDB\Client**: ``$uriOptions = [ 'loadBalanced' => true ];``
       | **Connection URI**: ``loadBalanced=false``

   * - :manual:`srvMaxHosts </reference/connection-string/#mongodb-urioption-urioption.srvmaxhosts>`
     - {+int-data-type+}
     - | **MongoDB\Client**: ``$uriOptions = [ 'srvMaxHosts' => 5 ];``
       | **Connection URI**: ``srvMaxHosts=5``

API Documentation
-----------------

For more information about the types used on this page, see the following API
documentation:

- :ref:`MongoDB\Client <php-mongodbclient>`
- `MongoDB\\Driver\\ReadPreference <https://www.php.net/manual/en/class.mongodb-driver-readpreference.php>`__