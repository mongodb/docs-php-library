.. _php-logging:

=================
Log Driver Events
=================

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 2
   :class: singlecol

.. facet::
   :name: genre
   :values: reference

.. meta::
   :keywords: debugging, printing

Overview
--------

In this guide, you can learn how to use the {+library-short+} to
set up and configure **logging**. Logging allows you to receive
information about database operations, server connections, errors,
and other events that occur while your application runs.

The {+library-short+} supports `Psr\\Log\\LoggerInterface
<https://www.php-fig.org/psr/psr-3>`__, a PSR-3
logger interface that configures your application to receive log messages.
You can register one or more ``Psr\Log\LoggerInterface`` objects to
send messages to the logger. The {+library-short+} is built on top of
the MongoDB C driver and the {+extension-short+}, so the logger receives event notifications
from both components.
  
Configure Logging
-----------------

To configure your application to receive messages about driver events,
create a logger class that implements the ``Psr\Log\LoggerInterface``
interface. Then, use the ``MongoDB\add_logger()`` function to register
your logger.

After registering a logger, the {+library-short+} generates log messages
as array values that resemble the following sample message:

.. code-block:: php
   :copyable: false

   [0] => Array
       (
          [0] => debug
          [1] => Created client with hash: ...
          [2] => PHONGO
       )

The sample log message includes the following information:

- Log level: Indicates the severity of the message. The ``debug`` level corresponds to
  standard driver activities. To view a list of possible levels, see `PSR\\Log\\LogLevel <https://www.php-fig.org/psr/psr-3/#5-psrlogloglevel>`__.
- Message: Describes the logged event, which signals the creation of a new client.
- Domain string: Specifies the driver component that emitted the log message. The
  ``PHONGO`` domain indicates that the {+extension-short+} generated the event.

Example
~~~~~~~

To implement ``Psr\Log\LoggerInterface``, you can create a class that
extends the ``Psr\Log\AbstractLogger`` class. ``AbstractLogger`` implements
``LoggerInterface`` and a generic ``log()`` method, which receives log
messages at each severity level.

This example performs the following actions:

- Creates a logger called ``MyLogger`` that extends the ``AbstractLogger`` class
  and records the log level, description, and domain of each event
- Registers the logger
- Prints each log message

.. literalinclude:: /includes/monitoring-logging/logging.php
   :language: php
   :start-after: start-register-logger
   :end-before: end-register-logger
   :dedent:

Write Custom Log Messages
-------------------------

You can generate custom log messages by using the ``PsrLogAdapter::writeLog()``
function. This function allows you to write directly to the logger and 
can help with application monitoring and debugging. Pass the severity level, domain, and
description as parameters to ``writeLog()``.

The following example writes log messages that have ``warning`` and 
``critical`` severity levels to the logger:

.. io-code-block::
   :copyable:

   .. input:: /includes/monitoring-logging/logging.php
      :start-after: start-write-messages
      :end-before: end-write-messages
      :language: php
      :dedent:

   .. output::
      :visible: false

      Array
      (
          [0] => Array
              (
                  [0] => warning
                  [1] => This is a warning message
                  [2] => domain1
              )
          [1] => Array
              (
                  [0] => critical
                  [1] => This is a critical message
                  [2] => domain2
              )
      )

Remove a Logger
---------------

To unregister a logger, pass your logger object as a parameter to the ``MongoDB\remove_logger()``
function. After calling this function, your logger no longer receives log
messages about your application.

The following example unregisters a logger:

.. literalinclude:: /includes/monitoring-logging/logging.php
   :language: php
   :start-after: start-remove-logger
   :end-before: end-remove-logger
   :dedent:

Additional Information
----------------------

To learn more about the PSR-3 logger, see `PSR-3: Logger Interface
<https://www.php-fig.org/psr/psr-3/>`__ in the PHP-FIG documentation.

API Documentation
~~~~~~~~~~~~~~~~~

To learn more about the {+library-short+} methods discussed in this guide, see the
following API documentation:

- :phpmethod:`MongoDB\add_logger()`
- :phpmethod:`MongoDB\remove_logger()`

To learn more about how the underlying C driver generates log messages, see `Logging
<https://mongoc.org/libmongoc/current/logging.html>`__ in the ``libmongoc``
API documentation.
